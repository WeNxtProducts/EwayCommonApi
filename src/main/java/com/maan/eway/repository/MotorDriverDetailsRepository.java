/*
 * Java domain class for entity "BankMaster" 
 * Created on 2022-08-24 ( Date ISO 2022-08-24 - Time 12:58:26 )
 * Generated by Telosys Tools Generator ( version 3.3.0 )
 */
 
 /*
 * Created on 2022-08-24 ( 12:58:26 )
 * Generated by Telosys ( http://www.telosys.org/ ) version 3.3.0
 */


package com.maan.eway.repository;

import java.math.BigDecimal;
import java.util.Date;
import java.util.List;
import java.util.Map;

import jakarta.transaction.Transactional;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Query;

import com.maan.eway.bean.MotorDriverDetails;
import com.maan.eway.bean.MotorDriverDetailsId;

 
 
public interface MotorDriverDetailsRepository  extends JpaRepository<MotorDriverDetails,MotorDriverDetailsId > , JpaSpecificationExecutor<MotorDriverDetails> {

	Long countByQuoteNo(String quoteNo);

	@Transactional
	void deleteByQuoteNo(String quoteNo);

	Long countByQuoteNoAndRiskId(String quoteNo, Integer vehicleId);

	List<MotorDriverDetails> findByQuoteNo(String quoteNo);

	@Transactional
	void deleteByQuoteNoAndRiskId(String quoteNo, Integer vehicleId);

	List<MotorDriverDetails> findByQuoteNoAndRiskId(String oldQuoteNo, Integer vehicleId);

	List<MotorDriverDetails> findByRequestReferenceNo(String requestReferenceNo);

	Long countByQuoteNoNotAndEndtCountAndOriginalPolicyNo(String quoteNo, BigDecimal bigDecimal,
			String originalPolicyNo);

	void deleteByQuoteNoNotAndEndtCountAndOriginalPolicyNo(String quoteNo, BigDecimal bigDecimal,
			String originalPolicyNo);

	Long countByRequestReferenceNoAndRiskId(String requestReferenceNo, Integer vehicleId);

	List<MotorDriverDetails> findByRequestReferenceNoAndRiskId(String requestReferenceNo, Integer parseInt);
	
	@Query(value="SELECT TYPE,SUM(COUNT) AS COUNT,SUM(PREMIUM) AS PREMIUM,CURRENCY_CODE FROM( SELECT (CASE WHEN (HPM.STATUS ='Y' AND RENEWAL_DATE_YN IS NULL) THEN 'QUOTE' WHEN (HPM.STATUS ='Y' AND RENEWAL_DATE_YN='Y') THEN 'RENEWAL QUOTE' END) AS TYPE, COUNT(*) AS COUNT, ROUND(SUM(OVERALL_PREMIUM_LC),0) AS PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_BUILDING_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE HPM.COMPANY_ID=?1 AND HPM.PRODUCT_ID=?2 AND HPM.STATUS IN ('Y')  AND (CASE WHEN 'Issuer'=?4 THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN (?3) AND (HPM.ENTRY_DATE>= ?5 AND HPM.ENTRY_DATE<=?6 ) AND CPM.COMPANY_ID=HPM.COMPANY_ID AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN UNION ALL SELECT (CASE WHEN (HPM.STATUS ='Y' AND RENEWAL_DATE_YN IS NULL) THEN 'QUOTE' WHEN (HPM.STATUS ='Y' AND RENEWAL_DATE_YN='Y') THEN 'RENEWAL QUOTE' END) AS TYPE, COUNT(*) AS COUNT, ROUND(SUM(OVERALL_PREMIUM_LC),0) AS PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_COMMON_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE HPM.COMPANY_ID=?1 AND HPM.PRODUCT_ID=?2 AND HPM.STATUS IN ('Y') AND (CASE WHEN 'Issuer'=?4 THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN (?3)  AND (HPM.ENTRY_DATE>= ?5 AND HPM.ENTRY_DATE<=?6 ) AND CPM.COMPANY_ID=HPM.COMPANY_ID   AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN) X GROUP BY TYPE,CURRENCY_CODE",nativeQuery=true)
	List<Map<String,Object>> findByCorporatePlus(String insuranceId,String productId,List<String> loginIds,String usertype,Date startDate,Date endDate);
//	List<Map<String,Object>> findByCorporatePlus(String insuranceId,String productId,List<String> loginIds,Date startDate,Date endDate,String usertype);

	//SELECT DATE,SUM(QUOTE_COUNT) AS QUOTE_COUNT,SUM(POLICY_COUNT) AS POLICY_COUNT,SUM(QUOTE_PREMIUM) AS QUOTE_PREMIUM, SUM(POLICY_PREMIUM) AS POLICY_PREMIUM,MAX(CURRENCY_CODE) AS CURRENCY_CODE FROM( SELECT (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) AS DATE, (CASE WHEN HPM.STATUS='Y' THEN COUNT(*) END) AS QUOTE_COUNT, (CASE WHEN HPM.STATUS='P' THEN COUNT(*) END) AS POLICY_COUNT, (CASE WHEN HPM.STATUS='Y' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS QUOTE_PREMIUM, (CASE WHEN HPM.STATUS='P' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS POLICY_PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_BUILDING_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE HPM.COMPANY_ID='100002' AND HPM.PRODUCT_ID='3' AND HPM.STATUS IN ('P','Y') AND (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) BETWEEN DATE_FORMAT('2024-01-01','%Y-%m-%d') AND DATE_FORMAT('2024-03-05','%Y-%m-%d') AND CPM.COMPANY_ID=HPM.COMPANY_ID AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) AND (CASE WHEN 'Issuer'='Broker' THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN ('login1') GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN,DATE UNION ALL SELECT (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) AS DATE, (CASE WHEN HPM.STATUS='Y' THEN COUNT(*) END) AS QUOTE_COUNT, (CASE WHEN HPM.STATUS='P' THEN COUNT(*) END) AS POLICY_COUNT, (CASE WHEN HPM.STATUS='Y' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS QUOTE_PREMIUM, (CASE WHEN HPM.STATUS='P' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS POLICY_PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_COMMON_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE HPM.COMPANY_ID='100002' AND HPM.PRODUCT_ID='14' AND HPM.STATUS IN ('P','Y') AND (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) BETWEEN DATE_FORMAT('2024-01-01','%Y-%m-%d') AND DATE_FORMAT('2024-03-05','%Y-%m-%d') AND CPM.COMPANY_ID=HPM.COMPANY_ID AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) AND (CASE WHEN 'Issuer'='Broker' THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN ('login1') GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN,DATE)X GROUP BY DATE
	@Query(value="SELECT DATE,SUM(QUOTE_COUNT) AS QUOTE_COUNT,SUM(POLICY_COUNT) AS POLICY_COUNT,SUM(QUOTE_PREMIUM) AS QUOTE_PREMIUM, SUM(POLICY_PREMIUM) AS POLICY_PREMIUM,MAX(CURRENCY_CODE) AS CURRENCY_CODE FROM( SELECT (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) AS DATE, (CASE WHEN HPM.STATUS='Y' THEN COUNT(*) END) AS QUOTE_COUNT, (CASE WHEN HPM.STATUS='P' THEN COUNT(*) END) AS POLICY_COUNT, (CASE WHEN HPM.STATUS='Y' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS QUOTE_PREMIUM, (CASE WHEN HPM.STATUS='P' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS POLICY_PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_BUILDING_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE HPM.COMPANY_ID=?1 AND HPM.PRODUCT_ID=?2 AND HPM.STATUS IN ('P','Y') AND (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) BETWEEN DATE_FORMAT(?5,'%Y-%m-%d') AND DATE_FORMAT(?6,'%Y-%m-%d') AND CPM.COMPANY_ID=HPM.COMPANY_ID AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) AND (CASE WHEN 'Issuer'=?4 THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN (?3) GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN,DATE  UNION ALL SELECT (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) AS DATE, (CASE WHEN HPM.STATUS='Y' THEN COUNT(*) END) AS QUOTE_COUNT, (CASE WHEN HPM.STATUS='P' THEN COUNT(*) END) AS POLICY_COUNT, (CASE WHEN HPM.STATUS='Y' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS QUOTE_PREMIUM, (CASE WHEN HPM.STATUS='P' THEN ROUND(SUM(OVERALL_PREMIUM_LC),0) END) AS POLICY_PREMIUM, MAX(CPM.CURRENCY_ID) AS CURRENCY_CODE FROM ESERVICE_COMMON_DETAILS HPM,EWAY_INSURANCE_COMPANY_MASTER CPM WHERE  HPM.COMPANY_ID=?1 AND HPM.PRODUCT_ID=?2 AND HPM.STATUS IN ('P','Y') AND (CASE WHEN HPM.STATUS='Y' THEN DATE_FORMAT(HPM.ENTRY_DATE,'%Y-%m-%d') ELSE DATE_FORMAT(HPM.UPDATED_DATE,'%Y-%m-%d') END) BETWEEN DATE_FORMAT(?5,'%Y-%m-%d') AND DATE_FORMAT(?6,'%Y-%m-%d') AND CPM.COMPANY_ID=HPM.COMPANY_ID AND CPM.AMEND_ID=(SELECT MAX(AMEND_ID) FROM EWAY_INSURANCE_COMPANY_MASTER WHERE CPM.COMPANY_ID=COMPANY_ID) AND (CASE WHEN 'Issuer'=?4 THEN HPM.APPLICATION_ID ELSE HPM.LOGIN_ID END) IN (?3) GROUP BY HPM.STATUS,HPM.RENEWAL_DATE_YN,DATE) X GROUP BY DATE",nativeQuery=true)
	List<Map<String, Object>> findByCorporatePlusChart(String insuranceId, String productId, List<String> loginIds,
			String userType, Date startDate, Date endDate);

	List<MotorDriverDetails> findByRequestReferenceNoAndStatusNot(String searchValue, String string);

	List<MotorDriverDetails> findByQuoteNoOrderByRiskIdAsc(String quoteNo);

	


}
