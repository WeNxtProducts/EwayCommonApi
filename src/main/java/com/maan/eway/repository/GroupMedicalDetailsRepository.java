/*
 * Java domain class for entity "GroupMedicalDetails" 
 * Created on 2023-07-31 ( Date ISO 2023-07-31 - Time 11:40:32 )
 * Generated by Telosys Tools Generator ( version 3.3.0 )
 */
 
 /*
 * Created on 2023-07-31 ( 11:40:32 )
 * Generated by Telosys ( http://www.telosys.org/ ) version 3.3.0
 */


package com.maan.eway.repository;

import java.util.List;
import java.util.Map;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Query;

import com.maan.eway.bean.GroupMedicalDetails;
import com.maan.eway.bean.GroupMedicalDetailsId;
/**
 * <h2>GroupMedicalDetailsRepository</h2>
 *
 * createdAt : 2023-07-31 - Time 11:40:32
 * <p>
 * Description: "GroupMedicalDetails" Repository
 */
 
 
 
public interface GroupMedicalDetailsRepository  extends JpaRepository<GroupMedicalDetails,GroupMedicalDetailsId > , JpaSpecificationExecutor<GroupMedicalDetails> {

	List<GroupMedicalDetails> findByMobileNo(String mobileNo);

	@Query(value = "SELECT POLICY_NO,INCEPTION_DATE,EXPIRY_DATE,MOBILE_NO, (SELECT SECTION_NAME FROM PRODUCT_SECTION_MASTER WHERE STATUS='Y' AND SYSDATE() BETWEEN EFFECTIVE_DATE_START AND EFFECTIVE_DATE_END AND COMPANY_ID=GMD.COMPANY_ID AND SECTION_ID=GMD.SECTION_ID AND PRODUCT_ID=GMD.PRODUCT_ID AND AMEND_ID=(SELECT MAX(AMEND_ID) FROM PRODUCT_SECTION_MASTER WHERE STATUS='Y' AND SYSDATE() BETWEEN EFFECTIVE_DATE_START AND EFFECTIVE_DATE_END AND COMPANY_ID=GMD.COMPANY_ID AND SECTION_ID=GMD.SECTION_ID AND PRODUCT_ID=GMD.PRODUCT_ID)) AS CLAIM_TYPE FROM GROUP_MEDICAL_DETAILS GMD WHERE MOBILE_NO = ?1 AND ?2 BETWEEN INCEPTION_DATE AND EXPIRY_DATE",nativeQuery = true)
	List<Map<String,Object>> getCustomerDetails(String mobileNo, String accidentDate);

	@Query(value = "SELECT GMD.POLICY_NO, GMD.CUSTOMER_NAME, GMD.MOBILE_CODE, GMD.MOBILE_NO, GMD.CLIENT_TRANSACTION_NO, GMD.ENTRY_DATE, GMD.INCEPTION_DATE, GMD.EXPIRY_DATE, GMD.LOGIN_ID, GMD.AMOUNT_PAID, GMD.TAX_PERCENTAGE, GMD.TAX_PREMIUM,GMD.PREMIUM,GMD.OVERALL_PREMIUM, (SELECT item_value FROM eway_list_item_value e WHERE item_type = 'PLAN_OPTED' AND ITEM_CODE = GMD.SECTION_ID AND STATUS = 'Y' AND AMEND_ID = (SELECT MAX(AMEND_ID) FROM eway_list_item_value WHERE item_type = 'PLAN_OPTED' AND ITEM_CODE = e.ITEM_CODE AND STATUS = 'Y')) AS PLAN_OBTAINED, (SELECT COMPANY_LOGO FROM eway_insurance_company_master ei WHERE company_id = GMD.COMPANY_ID AND STATUS = 'Y' AND amend_id = (SELECT MAX(amend_id) FROM eway_insurance_company_master WHERE company_id = ei.COMPANY_ID AND STATUS = 'Y')) AS COMPANY_LOGO, (SELECT COMPANY_NAME FROM eway_insurance_company_master ei WHERE company_id = GMD.COMPANY_ID AND STATUS = 'Y' AND amend_id = (SELECT MAX(amend_id) FROM eway_insurance_company_master WHERE company_id = ei.COMPANY_ID AND STATUS = 'Y')) AS COMPANY_NAME FROM GROUP_MEDICAL_DETAILS GMD WHERE GMD.POLICY_NO = ?1",nativeQuery = true)
	List<Map<String,Object>> getInalipaScheduleByPolicyNo(String policyNo);

	GroupMedicalDetails findByPolicyNo(String policyNo);
	
	@Query(nativeQuery=true,value ="SELECT item_value FROM eway_list_item_value WHERE item_code=?1 AND STATUS='Y'")
	public String getPlanName(String planId);
	
}
